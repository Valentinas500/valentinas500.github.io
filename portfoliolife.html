<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Portfolio Allocation and Consumption in a Simple Partial Equilibrium Life-Cycle Model</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Valentinas Rudys</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="research.html">Research</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="teaching.html">Overview</a>
    </li>
    <li>
      <a href="etrics.html">Econometrics</a>
    </li>
    <li>
      <a href="macro.html">Macroeconomics</a>
    </li>
  </ul>
</li>
<li>
  <a href="programming.html">Programming</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:vrudys@fordham.edu">
    <span class="fa fa-envelope-o"></span>
     
    Contact me
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Portfolio Allocation and Consumption in a Simple Partial Equilibrium Life-Cycle Model</h1>

</div>


<p>Assume a worker enters the model at age 20 and starts working. Every model period an agent makes saving and investment decisions. The solution is found starting with a terminal condition backwards using value function iteration. Code is adapted from Fortran Code by Cocco et al. (2005).</p>
<p>Matlab function using high-dimmensional arrays [<a href="CGM_Portfolio/WorkRetirementPortfolio_Model.m">download</a>]<br />
Matlab function (direct conversion from original code in Fortran) [<a href="CGM_Portfolio/CGM_WorkRetirementPortfolio_Model.m">download</a>]<br />
Fortran function [<a href="http://faculty.london.edu/fgomes/cgmcode.ZIP">download</a>]</p>
<pre class="codeinput">clearvars

<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! Exogenous parameters !</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!!!</span>

<span class="comment">%AGE=80+1; AGE0=1; Ret_age_early=42; Ret_age_norm=45; Ret_age_late=50;</span>
eta=10; eps=0.00001; beta=0.96;
<span class="comment">%Discretized grids</span>
RS_grid=0:0.01:1; LW_grid=4:404; C_grid=0:0.25:375; N_grid=0:0.2:0.8;
infinity=-1e+10;

<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! INVESTMENT RETURNS !</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>
sigma_r=0.157^2;
grid(1,1)= -1.73205080756887;
grid(2,1)=  0.0;
grid(3,1)=  1.73205080756887;
gr=grid*sigma_r^0.5;
gret = 1.06+gr;

RiskyReturns(1,1,:)=[gret(1),gret(2),gret(3)];
Prob=[0.1666666666666 0.6666666666666 0.1666666666666];
RiskFree=1.02;
ret_shock_states=3;

<span class="comment">%!!!!!!!!!!!!!!!!</span>
<span class="comment">%! LABOR INCOME !</span>
<span class="comment">%!!!!!!!!!!!!!!!!</span>

grid(1,1)= -1.73205080756887;
grid(2,1)=  0.0;
grid(3,1)=  1.73205080756887;
sigt_y=0.0738;
eyt=grid*sigt_y^0.5;
f_y=zeros(length(eyt),45);
inc_shock_states=3;
Prob2=[1/6,4/6,1/6];
ret_fac=0.68212;
a=-2.170042+2.700381;
b1=0.16818;
b2=-0.0323371/10;
b3=0.0019704/100;
<span class="keyword">for</span> ind1=21:65
   avg = exp(a+b1*ind1+b2*ind1^2+b3*ind1^3);
   Income(:,ind1-20) = avg*exp(eyt(:,1));
<span class="keyword">end</span>
Ret_income= ret_fac.*avg;

<span class="comment">%!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! TERMINAL PERIOD: Age 101</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!</span>

VR1(:,1)=Utility(LW_grid,0,1,eta);
opt_cons_VR(:,81)=LW_grid;
opt_risky_VR(:,81)=0;

<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! RETIREMENT PERIODS !</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>

<span class="keyword">for</span> age=99:-1:65
    <span class="comment">%for ind1=2:length(RS_grid)</span>
    <span class="comment">%    RS_grid(ind1)=RS_grid(ind1)-rand(1)/1e+4;</span>
    <span class="comment">%end</span>
    <span class="keyword">for</span> LW0=1:length(LW_grid)
            CurrentWealth=LW_grid(LW0);
            C_grid_new=C_grid;
            RS_grid_new=RS_grid;
            Investment=repmat(((LW_grid(LW0)-C_grid_new)'),1,length(RS_grid_new),ret_shock_states); Investment=Investment.*(Investment&gt;=0);
            C_grid_new=C_grid_new.*((LW_grid(LW0)-C_grid_new)&gt;=0);
            Returns=repmat(RS_grid_new,length(C_grid_new'),1,ret_shock_states).*repmat(RiskyReturns,length(C_grid_new),length(RS_grid_new),1)<span class="keyword">...</span>
                +(1-repmat(RS_grid_new,length(C_grid_new'),1,ret_shock_states)).*repmat(RiskFree,length(C_grid_new),length(RS_grid_new),ret_shock_states);
            FutureWealth=Investment.*Returns + repmat(Ret_income,length(C_grid_new'),length(RS_grid_new),ret_shock_states);
            FutureWealth=max(FutureWealth,min(LW_grid)); FutureWealth=min(FutureWealth,max(LW_grid));
            VR1_1=Prob(1)*interp1(LW_grid',VR1,FutureWealth(:,:,1),<span class="string">'spline'</span>);
            VR1_2=Prob(2)*interp1(LW_grid',VR1,FutureWealth(:,:,2),<span class="string">'spline'</span>);
            VR1_3=Prob(3)*interp1(LW_grid',VR1,FutureWealth(:,:,3),<span class="string">'spline'</span>);
            VR=repmat(Utility(C_grid_new',0,1,eta),1,length(RS_grid_new)) + beta.* ( VR1_1 + VR1_2 + VR1_3 );
            VR = max(VR,infinity);
            [ind_cons,ind_risky]=find(max(VR(:))==VR,1,<span class="string">'first'</span>);
            opt_cons_VR(LW0,age)=C_grid_new(ind_cons);
            opt_risky_VR(LW0,age)=RS_grid_new(ind_risky);
            opt_Invest_VR(LW0,age)=LW_grid(LW0)-opt_cons_VR(LW0,age);
            maxVR(LW0,1)=max(VR(:));
    <span class="keyword">end</span>
    VR1(:,1)=maxVR;
<span class="comment">%     age %Uncomment this line to see the progress as the algorithm progresses</span>
<span class="keyword">end</span>

<span class="comment">%!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! WORKING PERIODS !</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!</span>

<span class="keyword">for</span> age=64:-1:20
    <span class="keyword">for</span> LW0=1:length(LW_grid)
            CurrentWealth=LW_grid(LW0);
            C_grid_new=C_grid;
            RS_grid_new=RS_grid;
            Investment=repmat((LW_grid(LW0)-C_grid_new)',1,length(RS_grid_new),ret_shock_states,inc_shock_states);
            Returns=repmat(RS_grid_new,length(C_grid_new'),1,ret_shock_states,inc_shock_states).*repmat(RiskyReturns,length(C_grid_new),length(RS_grid_new),1,inc_shock_states)<span class="keyword">...</span>
                +(1-repmat(RS_grid_new,length(C_grid_new'),1,ret_shock_states,inc_shock_states)).*repmat(RiskFree,length(C_grid_new),length(RS_grid_new),ret_shock_states,inc_shock_states);
            FutureWealth=Investment.*Returns + repmat(reshape(Income(:,age+1-20),1,1,1,inc_shock_states),length(C_grid_new'),length(RS_grid_new),ret_shock_states,1);
            FutureWealth=max(FutureWealth,min(LW_grid)); FutureWealth=min(FutureWealth,max(LW_grid));
            VR1_11=Prob(1)*Prob2(1)*interp1(LW_grid',VR1,FutureWealth(:,:,1,1),<span class="string">'spline'</span>);
            VR1_12=Prob(1)*Prob2(2)*interp1(LW_grid',VR1,FutureWealth(:,:,1,2),<span class="string">'spline'</span>);
            VR1_13=Prob(1)*Prob2(3)*interp1(LW_grid',VR1,FutureWealth(:,:,1,3),<span class="string">'spline'</span>);
            VR1_21=Prob(2)*Prob2(1)*interp1(LW_grid',VR1,FutureWealth(:,:,2,1),<span class="string">'spline'</span>);
            VR1_22=Prob(2)*Prob2(2)*interp1(LW_grid',VR1,FutureWealth(:,:,2,2),<span class="string">'spline'</span>);
            VR1_23=Prob(2)*Prob2(3)*interp1(LW_grid',VR1,FutureWealth(:,:,2,3),<span class="string">'spline'</span>);
            VR1_31=Prob(3)*Prob2(1)*interp1(LW_grid',VR1,FutureWealth(:,:,3,1),<span class="string">'spline'</span>);
            VR1_32=Prob(3)*Prob2(2)*interp1(LW_grid',VR1,FutureWealth(:,:,3,2),<span class="string">'spline'</span>);
            VR1_33=Prob(3)*Prob2(3)*interp1(LW_grid',VR1,FutureWealth(:,:,3,3),<span class="string">'spline'</span>);
            VR=repmat(Utility(C_grid_new',0,1,eta),1,length(RS_grid_new)) + beta.* ( VR1_11+VR1_12+VR1_13+VR1_21+VR1_22+VR1_23+VR1_31+VR1_32+VR1_33 );
            [opt_cons_VR(LW0,age),opt_risky_VR(LW0,age)]=find(max(max(VR))==VR,1,<span class="string">'first'</span>);
            opt_cons_VR(LW0,age)=C_grid_new(opt_cons_VR(LW0,age));
            opt_risky_VR(LW0,age)=RS_grid_new(opt_risky_VR(LW0,age));
            opt_Invest_VR(LW0,age)=LW_grid(LW0)-opt_cons_VR(LW0,age);
            maxVR(LW0,1)=max(VR(:));
    <span class="keyword">end</span>
    VR1(:,1)=maxVR;
<span class="comment">%     age %Uncomment this line to see the progress as the algorithm progresses</span>
<span class="keyword">end</span>

<span class="comment">%!!!!!!!!!!!!!!</span>
<span class="comment">%! Figure 2-B !</span>
<span class="comment">%!!!!!!!!!!!!!!</span>

figure; hold <span class="string">on</span>;
figure; hold on;
plot(1:400,opt_risky_VR(1:400,20)); plot(1:400,opt_risky_VR(1:400,30));
plot(1:400,opt_risky_VR(1:400,55)); plot(1:400,opt_risky_VR(1:400,75));
plot(1:400,opt_risky_VR(1:400,99)); xlim([15 350]);
title(<span class="string">'Risky Share of Portfolio'</span>)
legend(<span class="string">'Year 20'</span>,<span class="string">'Year 30'</span>,<span class="string">'Year 55'</span>,<span class="string">'Year 75'</span>,<span class="string">'Year 99'</span>)

<span class="comment">%!!!!!!!!!!!!!</span>
<span class="comment">%! Functions !</span>
<span class="comment">%!!!!!!!!!!!!!</span>

<span class="keyword">function</span>[u]=Utility(c,n,gamma,eta)
u=((((c).^(gamma)).*(1-n).^(1-gamma)).^(1-eta))./(1-eta); <span class="comment">%Last good one</span>
<span class="keyword">end</span>

<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>
<span class="comment">%! The End of Program !</span>
<span class="comment">%!!!!!!!!!!!!!!!!!!!!!!</span>

</pre>
<p><img src="CGM_Portfolio/portfolio.png" /></p>
<!-- R function [[download]()]


Python function [[download](gss_bivariate.Py)]

-->
<style type="text/css">
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }
@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }
span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
</style>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
